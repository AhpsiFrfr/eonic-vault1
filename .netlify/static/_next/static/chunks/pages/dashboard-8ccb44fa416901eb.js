(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[343],{18997:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>N});var r=s(37876),a=s(65331),l=s(14232),n=s(89099);s(67710);var i=s(65579),o=s(78323);var d=s(6879);s(99742).env.SUPABASE_SERVICE_KEY;let c=(0,d.UU)("https://yantkvcqzgivgppuork.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlhbnRrdnVjcXpnaXZncHB1b3JrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYxNTA4MzIsImV4cCI6MjA2MTcyNjgzMn0.2kBJQYpXhqkUOPKr4Jf8Qb_kPxfkLDYZOWbPKQjwlZA");function u(e){let{userAddress:t,size:s="md",showStatus:a=!1}=e,[n,i]=l.useState(null);l.useEffect(()=>{(async()=>{let{data:e}=await c.from("user_profiles").select("*").eq("user_address",t).single();if(e)i(e);else{let{data:e}=await c.from("user_profiles").insert({user_address:t,display_name:o(t),status:"online"}).select().single();e&&i(e)}})();let e=c.channel("profile-changes").on("postgres_changes",{event:"*",schema:"public",table:"user_profiles",filter:"user_address=eq.".concat(t)},e=>{i(e.new)}).subscribe();return()=>{c.removeChannel(e)}},[t]);let o=e=>e?"".concat(e.slice(0,4),"...").concat(e.slice(-4)):"",d={sm:"w-8 h-8 text-xs",md:"w-10 h-10 text-sm",lg:"w-12 h-12 text-base"};return n?(0,r.jsxs)("div",{className:"relative group",children:[n.avatar_url?(0,r.jsx)("img",{src:n.avatar_url,alt:n.display_name||o(t),className:"".concat(d[s]," rounded-full object-cover")}):(0,r.jsx)("div",{className:"".concat(d[s]," bg-gray-700 rounded-full flex items-center justify-center text-white"),children:(n.display_name||o(t)).slice(0,2)}),a&&(0,r.jsx)("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 rounded-full border-2 border-gray-800\n          ".concat("online"===n.status?"bg-green-500":"bg-gray-500")}),(0,r.jsxs)("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 opacity-0 group-hover:opacity-100 transition-opacity bg-gray-800 text-white text-xs rounded px-2 py-1 whitespace-nowrap",children:[n.display_name||o(t),a&&(0,r.jsx)("div",{className:"text-xs opacity-75",children:"online"===n.status?"Online":"Last seen ".concat(new Date(n.last_seen).toLocaleString())})]})]}):(0,r.jsx)("div",{className:"".concat(d[s]," bg-gray-700 rounded-full flex items-center justify-center text-white"),children:o(t).slice(0,2)})}s(54587);var m=s(83015),h=s(22117),x=s(33162);function g(e){let{onUploadComplete:t,multiple:s=!1,accept:a="image/*,application/pdf,.doc,.docx,.txt",maxSize:n=0x3200000}=e,[i,o]=(0,l.useState)(!1),[d,u]=(0,l.useState)(null),m=(0,l.useRef)(null),h=async e=>{try{let s=e.target.files;if(!s||0===s.length)return;o(!0),u(null);let r=[];for(let e=0;e<s.length;e++){let t=s[e];if(console.log("Processing file:",t.name),t.size>n)throw Error("File ".concat(t.name," exceeds maximum size of ").concat(Math.round(n/1024/1024),"MB"));if(!a.split(",").some(e=>{if(e.startsWith("."))return t.name.toLowerCase().endsWith(e.toLowerCase());if(e.includes("/*")){let[s]=e.split("/");return t.type.startsWith("".concat(s,"/"))}return t.type===e}))throw Error("File type not allowed for ".concat(t.name,". Allowed types: ").concat(a));let l=t.name.split(".").pop(),i="".concat(Math.random().toString(36).substring(2),"_").concat(Date.now(),".").concat(l),o="".concat(i);console.log("Uploading to Supabase:",o);let{data:d,error:u}=await c.storage.from("attachments").upload(o,t,{cacheControl:"3600",upsert:!1});if(u)throw console.error("Supabase upload error:",u),Error("Failed to upload ".concat(t.name,": ").concat(u.message));console.log("Upload successful, getting public URL");let{data:{publicUrl:m}}=c.storage.from("attachments").getPublicUrl(o);r.push({url:m,type:t.type.startsWith("image/")?"image":"file",filename:t.name,size:t.size}),console.log("File processed successfully:",t.name)}t(r),m.current&&(m.current.value="")}catch(e){console.error("File upload error:",e),u(e instanceof Error?e.message:"Error uploading file"),m.current&&(m.current.value="")}finally{o(!1)}};return(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"file",ref:m,onChange:h,disabled:i,multiple:s,accept:a,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer disabled:cursor-not-allowed","aria-label":"File upload"}),(0,r.jsx)("div",{className:"flex items-center justify-center px-4 py-2 border rounded-md transition-colors ".concat(i?"bg-gray-100 border-gray-300 cursor-not-allowed":d?"bg-red-50 border-red-300 dark:bg-red-900/20 dark:border-red-800":"bg-white border-gray-300 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-600 dark:hover:bg-gray-700"),children:i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{className:"w-5 h-5 mr-2 text-gray-400 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"Uploading..."})]}):d?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("svg",{className:"w-5 h-5 mr-2 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,r.jsx)("span",{className:"text-sm text-red-600 dark:text-red-400",children:d})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("svg",{className:"w-5 h-5 mr-2 text-gray-500 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,r.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:s?"Choose files":"Choose file"})]})}),d&&(0,r.jsx)("div",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:d})]})}var p=s(91040);function f(e){let{walletAddress:t,onClose:s}=e,[a,n]=(0,l.useState)(""),[i,o]=(0,l.useState)(""),[d,c]=(0,l.useState)("online"),[u,m]=(0,l.useState)(!1),[h,x]=(0,l.useState)(!1),[g,f]=(0,l.useState)(""),[b,y]=(0,l.useState)(!0);(0,l.useEffect)(()=>{v()},[t]);let v=async()=>{try{console.log("Loading profile for wallet:",t),y(!0),f("");let e=await p.A.get("/api/profile?address=".concat(t));console.log("API Response:",e);let s=e.data;s?(console.log("Setting profile data:",s),n(s.display_name||""),o(s.avatar_url||""),c(s.status||"online")):console.log("No profile data received")}catch(t){var e,s,r;console.error("Error loading profile:",t),console.error("Error details:",null==(e=t.response)?void 0:e.data),f((null==(r=t.response)||null==(s=r.data)?void 0:s.error)||t.message||"Error loading profile")}finally{y(!1)}},j=async e=>{try{if(m(!0),f(""),!e.target.files||0===e.target.files.length)return;let s=e.target.files[0],r=new FormData;r.append("file",s);let a=(await p.A.post("/api/avatar",r)).data.url;o(a),await p.A.post("/api/profile",{user_address:t,avatar_url:a})}catch(e){var s,r;console.error("Error uploading avatar:",e),f((null==(r=e.response)||null==(s=r.data)?void 0:s.error)||e.message||"Error uploading avatar. Please try again.")}finally{m(!1)}},w=async e=>{e.preventDefault();try{x(!0),f(""),await p.A.post("/api/profile",{user_address:t,display_name:a||null,avatar_url:i||null,status:d||"online"}),s&&s()}catch(e){var r,l;console.error("Error updating profile:",e),f((null==(l=e.response)||null==(r=l.data)?void 0:r.error)||e.message||"Error updating profile. Please try again.")}finally{x(!1)}};return(0,r.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-md mx-auto",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-white mb-6",children:"Profile Settings"}),(0,r.jsxs)("div",{className:"mb-4 p-2 bg-gray-700 rounded text-sm text-gray-300 break-all",children:[(0,r.jsxs)("div",{children:["Wallet Address: ",t]}),(0,r.jsxs)("div",{children:["Loading: ",b?"true":"false"]}),(0,r.jsxs)("div",{children:["Error: ",g||"none"]})]}),(0,r.jsxs)("form",{onSubmit:w,className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:"Avatar"}),(0,r.jsxs)("div",{className:"mt-2 flex items-center space-x-4",children:[(0,r.jsx)("div",{className:"w-16 h-16 rounded-full bg-gray-700 flex items-center justify-center overflow-hidden",children:i?(0,r.jsx)("img",{src:i,alt:"Avatar",className:"w-full h-full object-cover"}):(0,r.jsx)("span",{className:"text-2xl text-gray-400",children:a?a[0].toUpperCase():"A"})}),(0,r.jsxs)("label",{className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded cursor-pointer",children:[u?"Uploading...":"Upload New",(0,r.jsx)("input",{type:"file",className:"hidden",accept:"image/*",onChange:j,disabled:u})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-300",children:"Display Name"}),(0,r.jsx)("input",{type:"text",id:"displayName",value:a,onChange:e=>n(e.target.value),className:"mt-1 block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter your display name"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-300",children:"Status"}),(0,r.jsxs)("select",{id:"status",value:d,onChange:e=>c(e.target.value),className:"mt-1 block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,r.jsx)("option",{value:"online",children:"Online"}),(0,r.jsx)("option",{value:"offline",children:"Offline"})]})]}),g&&(0,r.jsx)("div",{className:"text-red-500 text-sm",children:g}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-sm font-medium text-gray-300 hover:text-white focus:outline-none",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:h,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:h?"Saving...":"Save Changes"})]})]})]})}let b=e=>e?"".concat(e.slice(0,6),"...").concat(e.slice(-4)):"",y=["❤️","\uD83D\uDE24","\uD83D\uDE48","\uD83C\uDF2D","\uD83D\uDD25","\uD83D\uDC4D"];function v(e){var t;let{walletAddress:s,room:a,threadId:n}=e;if(!s)return null;let[i,o]=(0,l.useState)([]),[d,p]=(0,l.useState)(""),[j,w]=(0,l.useState)(null),[N,_]=(0,l.useState)([]),[k,S]=(0,l.useState)({messageId:null,position:null}),[C,E]=(0,l.useState)(null),[I,A]=(0,l.useState)(null),[L,M]=(0,l.useState)(""),[z,D]=(0,l.useState)(!1),[T,F]=(0,l.useState)(new Set),[O,B]=(0,l.useState)(null),[P,q]=(0,l.useState)(!1),W=(0,l.useRef)(null),J=(0,l.useRef)(null),R=(0,l.useRef)(),U=(0,l.useRef)(0),Y=()=>{var e;null==(e=W.current)||e.scrollIntoView({behavior:"smooth"})},V=async e=>{if(e.preventDefault(),d.trim()||0!==N.length)try{let{data:e,error:t}=await c.from("messages").insert({content:d.trim(),sender_address:s,room:a||"general",thread_id:n||(null==j?void 0:j.id)||null}).select("\n          *,\n          attachments:message_attachments(*),\n          reactions:message_reactions(*),\n          user_profile:user_profiles!user_profiles_user_address_fkey(*)\n        ").single();if(t)return void console.error("Error sending message:",t);if(e&&N.length>0){let{error:t}=await c.from("message_attachments").insert(N.map(t=>({message_id:e.id,type:t.type,url:t.url,filename:t.filename,size:t.size})));if(t)return void console.error("Error adding attachments:",t)}let{error:r}=await c.from("user_profiles").upsert({user_address:s,display_name:s.slice(0,6)+"..."+s.slice(-4),status:"online",last_seen:new Date().toISOString()});r&&console.error("Error creating profile:",r),p(""),_([]),w(null)}catch(e){console.error("Error sending message:",e),alert("Failed to send message. Please try again.")}};(0,l.useEffect)(()=>{(async()=>{let{data:e}=await c.from("messages").select("\n          *,\n          attachments:message_attachments(*),\n          reactions:message_reactions(*),\n          user_profile:user_profiles!user_profiles_user_address_fkey(*),\n          reply_count:messages!thread_id(count)\n        ").eq("room",a).eq("thread_id",n||null).order("created_at",{ascending:!0});e&&(o(e),Y())})();let e=c.channel("messages:".concat(a)).on("postgres_changes",{event:"*",schema:"public",table:"messages",filter:"room=eq.".concat(a," and thread_id=eq.").concat(n||null)},async e=>{if("INSERT"===e.eventType){let{data:t}=await c.from("messages").select("\n              *,\n              attachments:message_attachments(*),\n              reactions:message_reactions(*),\n              user_profile:user_profiles!user_profiles_user_address_fkey(*),\n              reply_count:messages!thread_id(count)\n            ").eq("id",e.new.id).single();t&&(o(e=>[...e,t]),Y())}else if("UPDATE"===e.eventType){let{data:t}=await c.from("messages").select("\n              *,\n              attachments:message_attachments(*),\n              reactions:message_reactions(*),\n              user_profile:user_profiles!user_profiles_user_address_fkey(*),\n              reply_count:messages!thread_id(count)\n            ").eq("id",e.new.id).single();t&&o(e=>e.map(e=>e.id===t.id?t:e))}}).subscribe();return()=>{c.removeChannel(e)}},[a,n]);let X=(e,t)=>{e.preventDefault(),S({messageId:t,position:{x:e.clientX,y:e.clientY}})},Z=async(e,t)=>{let r=i.find(e=>e.id===t);if(r){switch(e){case"reply":w(r);break;case"pin":case"forward":break;case"copy":navigator.clipboard.writeText(r.content);break;case"delete":if(r.sender_address===s){let{error:e}=await c.from("messages").delete().eq("id",t);e&&console.error("Error deleting message:",e)}}S({messageId:null,position:null})}},K=async(e,t)=>{try{let{data:r}=await c.from("message_reactions").select("id").eq("message_id",e).eq("user_address",s).eq("emoji",t).single();r?await c.from("message_reactions").delete().eq("id",r.id):await c.from("message_reactions").insert({message_id:e,user_address:s,emoji:t})}catch(e){console.error("Error toggling reaction:",e)}};(0,l.useEffect)(()=>{let e=e=>{J.current&&!J.current.contains(e.target)&&S({messageId:null,position:null})};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,l.useEffect)(()=>{let e=c.channel("typing-indicators").on("postgres_changes",{event:"*",schema:"public",table:"typing_indicators",filter:"room=eq.".concat(a)},e=>{"DELETE"===e.eventType?F(t=>{let s=new Set(t);return s.delete(e.old.user_address),s}):("INSERT"===e.eventType||"UPDATE"===e.eventType)&&F(t=>{let s=new Set(t);return s.add(e.new.user_address),s})}).subscribe();return()=>{c.removeChannel(e)}},[a]),(0,l.useEffect)(()=>{if(i.length>0){let e=i[i.length-1];e.sender_address!==s&&c.from("read_receipts").upsert({message_id:e.id,user_address:s,read_at:new Date().toISOString()})}},[i]);let H=async(e,t)=>{let{error:r}=await c.from("messages").update({content:t,edited_at:new Date().toISOString(),edited_by:s}).eq("id",e);r?console.error("Error editing message:",r):(A(null),M(""))};return(0,l.useEffect)(()=>{Y()},[i]),(0,r.jsxs)("div",{className:"flex-1 h-full flex flex-col bg-gray-800 rounded-lg overflow-hidden relative",children:[(0,r.jsx)("button",{onClick:()=>q(!0),className:"absolute top-4 right-4 p-2 text-white hover:bg-gray-700 rounded-full",title:"Profile Settings",children:(0,r.jsx)(m.A,{className:"w-6 h-6"})}),P&&(0,r.jsx)("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50",children:(0,r.jsx)(f,{walletAddress:s,onClose:()=>q(!1)})}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",ref:W,children:[i.map(e=>(0,r.jsxs)("div",{className:"group flex items-start gap-3 ".concat(e.sender_address===s?"flex-row-reverse":"flex-row"),onContextMenu:t=>X(t,e.id),onDoubleClick:()=>{e.sender_address===s&&(A(e.id),M(e.content))},children:[(0,r.jsx)(u,{userAddress:e.sender_address,size:"sm",showStatus:!0}),(0,r.jsxs)("div",{className:"relative max-w-[70%] ".concat(e.sender_address===s?"bg-blue-500 text-white":"bg-gray-700 text-white"," rounded-lg p-4 shadow"),children:[(0,r.jsx)("button",{onClick:t=>X(t,e.id),className:"absolute -right-10 top-2 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded hover:bg-gray-600 text-white",children:(0,r.jsx)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),I===e.id?(0,r.jsx)("form",{onSubmit:t=>{t.preventDefault(),H(e.id,L)},children:(0,r.jsx)("input",{type:"text",value:L,onChange:e=>M(e.target.value),className:"w-full p-1 bg-gray-700 text-white rounded border border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0,onKeyDown:e=>{"Escape"===e.key&&(A(null),M(""))}})}):(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"whitespace-pre-wrap break-words",children:e.content}),e.edited_at&&(0,r.jsx)("span",{className:"text-xs text-white opacity-50 ml-2",children:"(edited)"})]}),e.attachments&&e.attachments.length>0&&(0,r.jsx)("div",{className:"mt-3 space-y-2",children:e.attachments.map(t=>"image"===t.type?(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("img",{src:t.url,alt:t.filename,className:"max-w-full rounded-lg shadow-sm",style:{maxHeight:"200px",objectFit:"contain"}}),(0,r.jsxs)("div",{className:"mt-1 flex items-center justify-between text-xs text-gray-500 dark:text-gray-400",children:[(0,r.jsx)("span",{children:t.filename}),(0,r.jsxs)("span",{children:["(",Math.round(t.size/1024),"KB)"]})]})]},t.id):(0,r.jsxs)("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-2 rounded ".concat(e.sender_address===s?"bg-blue-600 hover:bg-blue-700":"bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500"),children:[(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})}),(0,r.jsx)("span",{className:"text-sm truncate",children:t.filename}),(0,r.jsxs)("span",{className:"text-xs opacity-75",children:["(",Math.round(t.size/1024),"KB)"]})]},t.id))}),(e.reply_count>0||e.thread_id)&&(0,r.jsx)("button",{onClick:()=>B(e.thread_id?i.find(t=>t.id===e.thread_id):e),className:"mt-2 text-xs text-blue-400 hover:text-blue-300 transition-colors",children:e.thread_id?"View thread":"".concat(e.reply_count," ").concat(1===e.reply_count?"reply":"replies")}),(0,r.jsxs)("div",{className:"mt-2 text-xs text-white opacity-75 flex items-center justify-between",children:[(0,r.jsx)("span",{children:b(e.sender_address)}),(0,r.jsx)("span",{children:new Date(e.created_at).toLocaleTimeString()})]}),e.reactions&&e.reactions.length>0&&(0,r.jsx)("div",{className:"absolute -bottom-6 left-0 flex gap-1",children:Object.entries(e.reactions.reduce((e,t)=>(e[t.emoji]=(e[t.emoji]||0)+1,e),{})).map(t=>{var a;let[l,n]=t;return(0,r.jsxs)("button",{onClick:()=>K(e.id,l),className:"flex items-center gap-1 px-2 py-1 rounded-full text-xs\n                        ".concat((null==(a=e.reactions)?void 0:a.some(e=>e.emoji===l&&e.user_address===s))?"bg-blue-900":"bg-gray-800","\n                        hover:bg-blue-900 text-white transition-colors"),children:[(0,r.jsx)("span",{children:l}),(0,r.jsx)("span",{className:"text-white",children:n})]},l)})})]}),(0,r.jsx)("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity ml-2 flex items-center",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("button",{onClick:()=>E(C===e.id?null:e.id),className:"p-1.5 rounded hover:bg-gray-600 text-white",children:(0,r.jsx)(h.A,{className:"w-4 h-4 text-white"})}),C===e.id&&(0,r.jsx)("div",{className:"absolute bottom-full left-0 mb-2 p-2 bg-gray-800 rounded-lg shadow-lg flex gap-1 z-10",children:y.map(t=>(0,r.jsx)("button",{onClick:()=>{K(e.id,t),E(null)},className:"p-1.5 hover:bg-gray-700 rounded transition-colors text-white",children:t},t))})]})})]},e.id)),T.size>0&&(0,r.jsx)("div",{className:"text-xs text-white opacity-75 p-2",children:Array.from(T).filter(e=>e!==s).map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(u,{userAddress:e,size:"sm"}),(0,r.jsx)("span",{children:"is typing..."})]},e))}),(0,r.jsx)("div",{ref:W}),O&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-gray-800 rounded-lg w-full max-w-2xl max-h-[80vh] flex flex-col",children:[(0,r.jsxs)("div",{className:"p-4 border-b border-gray-700 flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Thread"}),(0,r.jsx)("button",{onClick:()=>B(null),className:"text-white opacity-75 hover:opacity-100",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsxs)("div",{className:"p-4 flex-1 overflow-y-auto",children:[(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)(u,{userAddress:O.sender_address,showStatus:!0}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"bg-gray-700 rounded-lg p-3",children:(0,r.jsx)("p",{className:"text-white whitespace-pre-wrap break-words",children:O.content})}),(0,r.jsx)("div",{className:"mt-1 text-xs text-white opacity-75",children:new Date(O.created_at).toLocaleString()})]})]})}),(0,r.jsx)(v,{walletAddress:s,room:a,threadId:O.id})]})]})}),k.messageId&&k.position&&(0,r.jsxs)("div",{ref:J,style:{position:"fixed",top:k.position.y,left:k.position.x,zIndex:50},className:"bg-gray-800 rounded-lg shadow-lg py-1 min-w-[160px] text-white",children:[(0,r.jsxs)("button",{onClick:()=>Z("reply",k.messageId),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",children:[(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})}),"Reply"]}),(0,r.jsxs)("button",{onClick:()=>Z("pin",k.messageId),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",children:[(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})}),"Pin"]}),(0,r.jsxs)("button",{onClick:()=>Z("copy",k.messageId),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",children:[(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})}),"Copy Text"]}),(0,r.jsxs)("button",{onClick:()=>Z("forward",k.messageId),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",children:[(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),"Forward"]}),(null==(t=i.find(e=>e.id===k.messageId))?void 0:t.sender_address)===s&&(0,r.jsxs)("button",{onClick:()=>Z("delete",k.messageId),className:"w-full px-4 py-2 text-left text-sm text-red-400 hover:bg-red-900/20 flex items-center gap-2",children:[(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete"]})]})]}),(0,r.jsxs)("div",{className:"p-4 border-t border-gray-700 bg-gray-800",children:[j&&(0,r.jsxs)("div",{className:"mb-2 p-2 bg-gray-700 rounded-lg flex items-center justify-between text-white",children:[(0,r.jsxs)("div",{className:"flex items-center text-sm text-white opacity-75",children:[(0,r.jsx)(x.A,{className:"w-4 h-4 mr-2"}),(0,r.jsxs)("span",{children:["Replying to ",b(j.sender_address)]})]}),(0,r.jsx)("button",{onClick:()=>w(null),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsxs)("form",{onSubmit:V,className:"flex items-center gap-2",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)("input",{type:"text",value:d,onChange:e=>p(e.target.value),placeholder:"Type a message...",className:"w-full p-2 rounded-lg bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",onKeyDown:()=>{let e=Date.now();e-U.current>1e3&&(U.current=e,z||(D(!0),c.from("typing_indicators").upsert({user_address:s,room:a,last_typed:new Date().toISOString()})),R.current&&clearTimeout(R.current),R.current=setTimeout(async()=>{D(!1),await c.from("typing_indicators").delete().eq("user_address",s).eq("room",a)},2e3))}})}),(0,r.jsx)("button",{type:"submit",disabled:!d.trim()&&0===N.length,className:"ml-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Send"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)("div",{className:"text-white",children:(0,r.jsx)(g,{onUploadComplete:e=>_(e),multiple:!0,accept:"image/*,application/pdf,.doc,.docx,.txt",maxSize:0xa00000})})}),N.length>0&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-white opacity-75",children:[(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})}),(0,r.jsxs)("span",{children:[N.length," file(s) attached"]}),(0,r.jsx)("button",{type:"button",onClick:()=>_([]),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]})]})]})]})}var j=s(97685);let w=[{id:"early_adopter",name:"Early Adopter",lore:"You were among the first to enter the Vault."},{id:"first_referral",name:"First Referral",lore:"You called another into the dark."},{id:"ghost_in_the_shell",name:"Ghost In The Shell",lore:"You forged your identity from the shadows."},{id:"dimensional_echo",name:"Dimensional Echo",lore:"Your voice was heard across timelines."},{id:"hidden_key",name:"The Hidden Key",lore:"You found what was not meant to be found."}],N=()=>{let{connected:e,publicKey:t,connecting:s}=(0,a.v)(),i=(0,n.useRouter)(),[o,c]=(0,l.useState)("Community"),[u,m]=(0,l.useState)(!1),[h,x]=(0,l.useState)(""),[g,p]=(0,l.useState)("online"),[f,b]=(0,l.useState)(["early_adopter","ghost_in_the_shell"]),[y,N]=(0,l.useState)(null),[_,k]=(0,l.useState)(["Hello world!","Welcome to the Eonic Vault."]),[S,C]=(0,l.useState)("");if((0,l.useEffect)(()=>{s||e||i.push("/")},[e,s,i]),(0,l.useEffect)(()=>{t&&(async()=>{try{let{data:e,error:s}=await E.from("user_profiles").select("*").eq("user_address",t.toString()).single();if(s)throw s;e?(x(e.display_name||t.toString().slice(0,8)),p(e.status||"online")):x(t.toString().slice(0,8))}catch(e){console.error("Error loading profile:",e),x(t.toString().slice(0,8))}})()},[t]),s)return(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-[#0D0D0F] text-gray-200",children:(0,r.jsx)("div",{className:"text-lg",children:"Loading..."})});if(!e)return null;let E=(0,d.UU)("https://yantkvcqzgivgppuork.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlhbnRrdnVjcXpnaXZncHB1b3JrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYxNTA4MzIsImV4cCI6MjA2MTcyNjgzMn0.2kBJQYpXhqkUOPKr4Jf8Qb_kPxfkLDYZOWbPKQjwlZA"),I=async()=>{if(t)try{let{error:e}=await E.from("user_profiles").upsert({user_address:t.toString(),display_name:h,status:g,last_seen:new Date().toISOString(),updated_at:new Date().toISOString()});if(e)throw e;j.oR.success("Profile updated successfully!"),m(!1)}catch(e){console.error("Error updating profile:",e),j.oR.error(e.message||"Failed to update profile")}};return(0,r.jsxs)("div",{className:"min-h-screen bg-[#0D0D0F]",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-6 p-8 font-sans",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-white text-2xl font-bold",children:"Dashboard"}),(0,r.jsx)("button",{className:"px-4 py-2 bg-gradient-to-r from-[#00d8ff] to-[#8a2be2] rounded-lg text-white font-semibold shadow-md hover:scale-105 transition-transform",onClick:()=>m(!0),children:"Edit Profile"})]}),(0,r.jsx)("div",{className:"flex gap-6 border-b border-gray-800 pb-2",children:["NFTs","Community","Cabal","Achievements"].map(e=>(0,r.jsx)("div",{onClick:()=>c(e),className:"px-4 py-2 cursor-pointer text-sm font-medium transition-all duration-200 ".concat(e===o?"text-[#00d8ff] border-b-2 border-[#00d8ff]":"text-gray-400 hover:text-white"),children:e},e))}),(0,r.jsxs)("div",{className:"bg-[#1E1E2A] text-gray-200 rounded-xl p-6 min-h-[400px] shadow-[0_0_10px_rgba(0,216,255,0.2)] flex flex-col justify-between",children:["NFTs"===o&&(0,r.jsxs)("div",{className:"flex flex-col items-center text-center",children:[(0,r.jsx)("h2",{className:"text-xl text-[#00d8ff] mb-4",children:"Timepiece Evolution"}),(0,r.jsx)("div",{className:"w-40 h-40 bg-[#2A2A3A] rounded-full flex items-center justify-center shadow-inner mb-4",children:(0,r.jsx)("span",{className:"text-white text-xl",children:"Stage 2"})}),(0,r.jsx)("p",{className:"text-sm text-gray-400",children:"Your Timepiece has evolved based on referral activity."})]}),"Community"===o&&(0,r.jsx)("div",{className:"h-[600px]",children:(0,r.jsx)(v,{walletAddress:(null==t?void 0:t.toString())||"",room:"general"})}),"Cabal"===o&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-[#00d8ff] text-lg font-semibold mb-2",children:"Coming Soon"}),(0,r.jsx)("p",{children:"The EONIC NFT collection will be launching on June 1st, 2025. Stay tuned!"})]}),"Achievements"===o&&(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-6",children:w.map(e=>{let t=f.includes(e.id);return(0,r.jsxs)("div",{className:"flex flex-col items-center text-center p-4 rounded-lg transition duration-200 cursor-pointer border ".concat(t?"bg-[#1E1E2A] border-[#00d8ff] shadow-[0_0_8px_rgba(0,216,255,0.4)] hover:scale-105":"bg-[#13131A] border-gray-700 opacity-40"),onClick:()=>t&&N(e),children:[(0,r.jsx)("div",{className:"w-16 h-16 rounded-full bg-[#2A2A3A] mb-2 flex items-center justify-center",children:"\uD83D\uDEE1️"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:e.name})]},e.id)})})]})]}),y&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-[#1E1E2A] text-white p-6 rounded-xl max-w-md w-full text-center border border-[#00d8ff] shadow-[0_0_10px_rgba(0,216,255,0.3)]",children:[(0,r.jsx)("h3",{className:"text-xl font-bold mb-2",children:y.name}),(0,r.jsx)("p",{className:"text-gray-300 mb-4 italic",children:y.lore}),(0,r.jsx)("button",{onClick:()=>N(null),className:"px-4 py-2 bg-gradient-to-r from-[#00d8ff] to-[#8a2be2] rounded text-white shadow hover:scale-105 transition-transform",children:"Close"})]})}),u&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-[#1E1E2A] rounded-xl p-6 w-full max-w-md text-white shadow-[0_0_10px_rgba(0,216,255,0.3)]",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Edit Profile"}),(0,r.jsx)("input",{value:h,onChange:e=>x(e.target.value),className:"w-full mb-3 p-2 bg-[#2A2A3A] border border-[#444] rounded text-white",placeholder:"Display Name"}),(0,r.jsxs)("select",{value:g,onChange:e=>p(e.target.value),className:"w-full mb-6 p-2 bg-[#2A2A3A] border border-[#444] rounded text-white",children:[(0,r.jsx)("option",{value:"online",children:"Online"}),(0,r.jsx)("option",{value:"offline",children:"Offline"})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,r.jsx)("button",{className:"text-gray-400 hover:text-white",onClick:()=>m(!1),children:"Cancel"}),(0,r.jsx)("button",{onClick:I,className:"px-4 py-2 bg-gradient-to-r from-[#00d8ff] to-[#8a2be2] rounded text-white shadow-md",children:"Save Changes"})]})]})})]})}},29122:()=>{},47790:()=>{},67721:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return s(18997)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[299,724,329,185,636,593,792],()=>t(67721)),_N_E=e.O()}]);